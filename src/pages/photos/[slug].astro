---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import PhotoLayout from "../../layouts/PhotoLayout.astro";
export const getStaticPaths = (async () => {
  const photos = await getCollection("photos");
  return photos.map((photo) => {
    return {
      params: { slug: photo.id },
      props: { photo },
    };
  });
}) satisfies GetStaticPaths;

const { photo } = Astro.props;
const photos = photo.data.photos.map(({ src, ...rest }) => ({
  src,
  isPortrait: src.height > src.width,
  ...rest,
}));
---

<style>
  .container {
    margin-top: 2rem;
  }

  figure {
    margin-bottom: 3rem;
    text-align: center;
  }

  figure div {
    background: #000;
  }

  body.dark figure div {
    background: #111;
  }

  figure div img {
    display: block;
    margin: 0 auto 0.5rem auto;
  }

  body.hide-figcaption figcaption span {
    background: #000;

    &:hover {
      background: transparent;
    }
  }

  body.hide-figcaption.dark figcaption span {
    background: #fefefe;
  }

  .photo {
    width: 100%;
    height: 100%;

    &.portrait {
      max-height: calc(100vh - 8rem);
      @media (max-width: 1024px) {
        max-height: calc(100vh - 2rem);
      }
    }

    &.landscape {
      max-width: calc(100vw - 8rem);
      @media (max-width: 1024px) {
        max-width: calc(100vw - 2rem);
      }
    }
  }

  .subtle {
    color: rgba(0, 0, 0, 0.6);
    font-size: 0.8em;
  }

  body.dark .subtle {
    color: rgba(255, 255, 255, 0.6);
  }
</style>

<script>
  document.addEventListener("click", (event) => {
    const target = event.target as HTMLElement;
    if (target.tagName === "IMG" && target.classList.contains("photo")) {
      document.body.classList.toggle("hide-figcaption");
    }
  });
</script>

<PhotoLayout title={photo.data.title} isAlbumPage={true}>
    <div class="container">
      {photos.map((p) => (
          <figure>
              <div>
                <Image src={p.src} alt={p.title ?? "Unknown photo"} width={1024} class={`photo ${p.isPortrait ? "portrait" : "landscape"}`} />
              </div>
              <figcaption><span>{p.title ?? "Unknown photo"}</span></figcaption>
          </figure>
      ))}
    </div>

    <p class="subtle">Copyright Odin {new Date().getFullYear()}</p>
</PhotoLayout>